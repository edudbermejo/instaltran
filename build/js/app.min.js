(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

require('../features/credentials/login');

require('../features/inside');

angular.module('entry', ['credentials.login', 'inside']);

},{"../features/credentials/login":4,"../features/inside":8}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider, $urlRouterProvider) {
    'ngInject';

    $urlRouterProvider.otherwise('/login');

    $stateProvider.state('login', {
        url: '/login',
        templateUrl: 'src/features/credentials/login/template.html',
        controller: 'LoginController as lc'
    });
};

},{}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($usersManager, $state, $externalCalls) {
    'ngInject';

    var lc = this;

    lc.tryLogin = function () {

        if (!lc.user) {
            Materialize.toast('No se ha introducido usuario', 2000);
        } else {
            if (!lc.pass) {
                Materialize.toast('El campo contraseña es obligatorio', 2000);
            } else {

                $externalCalls.getUserByUsername(lc.user).then(logAndJump).catch(function () {
                    Materialize.toast('El usuario introducido no existe', 2000);
                });
            }
        }

        function logAndJump(user) {
            if (lc.pass === user.password) {
                $usersManager.setLoggedUser(user);
                $state.go('inside.timeline');
            } else {
                Materialize.toast('La contraseña no es correcta', 2000);
            }
        }
    };
};

},{}],4:[function(require,module,exports){
'use strict';

require('../../transversal/usersManager');

require('../../transversal/externalCalls');

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('credentials.login', ['ui.router', 'transversal.usersManager', 'transversal.externalCalls']).config(_config2.default).controller('LoginController', _controller2.default);

},{"../../transversal/externalCalls":12,"../../transversal/usersManager":14,"./config":2,"./controller":3}],5:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    return {
        bindings: {
            photo: '<'
        },
        controller: function controller() {},
        templateUrl: 'src/features/inside/components/photoInList/template.html'
    };
};

},{}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('inside', {
        url: '/inside',
        abstract: true,
        templateUrl: 'src/features/inside/template.html',
        controller: 'InsideController as ic'
    });
};

},{}],7:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    'ngInject';

    var ic = this;
};

},{}],8:[function(require,module,exports){
'use strict';

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

require('./timeline');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('inside', ['ui.router', 'inside.timeline']).config(_config2.default).controller('InsideController', _controller2.default);

},{"./config":6,"./controller":7,"./timeline":11}],9:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('inside.timeline', {
        url: '/timeline',
        templateUrl: '/src/features/inside/timeline/template.html',
        controller: 'TimelineController as tc'
    });
};

},{}],10:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($externalCalls) {
    'ngInject';

    var tc = this;

    var _page = 1;

    /*tc.photos = [{
        user_id : 'Gastly',
        image : 'img/prueba.png',
        likes : 123,
        title : 'Buh!'
    }, {
        user_id : 'Haunter',
        image : 'img/haunter.png',
        likes : 321,
        title : 'Buh++!'
    }];*/

    tc.photos = $externalCalls.getPhotosTimeline(_page);

    tc.morePhotos = function () {
        _page++, tc.photos.push($externalCalls.getPhotos(_page));
    };
};

},{}],11:[function(require,module,exports){
'use strict';

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

var _photoInList = require('../components/photoInList');

var _photoInList2 = _interopRequireDefault(_photoInList);

require('../../transversal/externalCalls');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('inside.timeline', ['ui.router', 'transversal.externalCalls']).config(_config2.default).controller('TimelineController', _controller2.default).component('instTimePhoto', (0, _photoInList2.default)());

},{"../../transversal/externalCalls":12,"../components/photoInList":5,"./config":9,"./controller":10}],12:[function(require,module,exports){
'use strict';

var _service = require('./service');

var _service2 = _interopRequireDefault(_service);

require('../usersManager');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('transversal.externalCalls', ['transversal.usersManager']).service('$externalCalls', _service2.default);

},{"../usersManager":14,"./service":13}],13:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($usersManager, $http, $q) {
    'ngInject';

    var _url = 'http://localhost:2222';

    // Recupera fotos con paginacion. Se pasan los followed para hacer join.
    this.getPhotosTimeline = function (page) {
        var _qu = $q.defer();

        var _user = $usersManager.getLoggedUser();

        return $http({
            url: _url + '/photos',
            method: 'GET',
            params: { page: page,
                userid: _user._id }
        }).then(backPhotosOK).catch(backPhotosWrong);

        function backPhotosOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backPhotosWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    // Recupera un usuario haciendo uso de su id (en tabla de mongo)
    this.getUserById = function (id) {

        var _qu = $q.defer();

        return $http({
            url: _url + '/users/' + id,
            method: 'GET'
        }).then(backUserOK).catch(backUserWrong);

        function backUserOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backUserWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    // Recupera un usuario haciendo uso de su username
    this.getUserByUsername = function (username) {

        var _qu = $q.defer();

        $http({
            url: _url + '/users',
            params: {
                username: username,
                strict: "s"
            },
            method: 'GET'
        }).then(backUserOK).catch(backUserWrong);

        function backUserOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backUserWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };
};

},{}],14:[function(require,module,exports){
'use strict';

var _service = require('./service');

var _service2 = _interopRequireDefault(_service);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('transversal.usersManager', []).service('$usersManager', _service2.default);

},{"./service":15}],15:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    'ngInject';

    var _logged;

    this.setLoggedUser = function (user) {
        _logged = user;
    };

    this.getLoggedUser = function () {
        return _logged;
    };

    this.loggout = function () {
        _logged = null;
    };
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcY3JlZGVudGlhbHNcXGxvZ2luXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xcbG9naW5cXGNvbnRyb2xsZXIuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xcbG9naW5cXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcaW5zaWRlXFxjb21wb25lbnRzXFxwaG90b0luTGlzdFxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXGNvbmZpZy5qcyIsInNyY1xcZmVhdHVyZXNcXGluc2lkZVxcY29udHJvbGxlci5qcyIsInNyY1xcZmVhdHVyZXNcXGluc2lkZVxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHRpbWVsaW5lXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHRpbWVsaW5lXFxjb250cm9sbGVyLmpzIiwic3JjXFxmZWF0dXJlc1xcaW5zaWRlXFx0aW1lbGluZVxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFx0cmFuc3ZlcnNhbFxcZXh0ZXJuYWxDYWxsc1xcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFx0cmFuc3ZlcnNhbFxcZXh0ZXJuYWxDYWxsc1xcc2VydmljZS5qcyIsInNyY1xcZmVhdHVyZXNcXHRyYW5zdmVyc2FsXFx1c2Vyc01hbmFnZXJcXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcdHJhbnN2ZXJzYWxcXHVzZXJzTWFuYWdlclxcc2VydmljZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQ0dBLFFBQ0ssTUFETCxDQUNZLE9BRFosRUFDcUIsQ0FDYixtQkFEYSxFQUViLFFBRmEsQ0FEckI7Ozs7Ozs7OztrQkNIZSxVQUFVLGNBQVYsRUFBMEIsa0JBQTFCLEVBQThDO0FBQ3pELGVBRHlEOztBQUV6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Q0FBdUIsS0FBdkIsRUFBOEI7QUFDMUIsZ0JBQUksTUFBSixDQUFXLE9BQVgsRUFEMEI7U0FBOUI7O0FBSUEsZUFBTyxJQUFJLE9BQUosQ0ExQmdDO0tBQWxCLENBN0RzQjtDQUFwQzs7Ozs7Ozs7Ozs7QUNFZixRQUNLLE1BREwsQ0FDWSwwQkFEWixFQUN3QyxFQUR4QyxFQUVLLE9BRkwsQ0FFYSxlQUZiOzs7Ozs7Ozs7a0JDRmUsWUFBWTtBQUN2QixlQUR1Qjs7QUFFdkIsUUFBSSxPQUFKLENBRnVCOztBQUl2QixTQUFLLGFBQUwsR0FBcUIsVUFBUyxJQUFULEVBQWU7QUFDaEMsa0JBQVUsSUFBVixDQURnQztLQUFmLENBSkU7O0FBUXZCLFNBQUssYUFBTCxHQUFxQixZQUFXO0FBQzVCLGVBQU8sT0FBUCxDQUQ0QjtLQUFYLENBUkU7O0FBWXZCLFNBQUssT0FBTCxHQUFlLFlBQVc7QUFDdEIsa0JBQVUsSUFBVixDQURzQjtLQUFYLENBWlE7Q0FBWiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgJy4uL2ZlYXR1cmVzL2NyZWRlbnRpYWxzL2xvZ2luJztcclxuaW1wb3J0ICcuLi9mZWF0dXJlcy9pbnNpZGUnXHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdlbnRyeScsIFtcclxuICAgICAgICAnY3JlZGVudGlhbHMubG9naW4nLFxyXG4gICAgICAgICdpbnNpZGUnXHJcbiAgICBdKTsiLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9sb2dpbicpO1xyXG5cclxuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdsb2dpbicsIHtcclxuICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnc3JjL2ZlYXR1cmVzL2NyZWRlbnRpYWxzL2xvZ2luL3RlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXIgYXMgbGMnXHJcbiAgICB9KVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCR1c2Vyc01hbmFnZXIsICRzdGF0ZSwgJGV4dGVybmFsQ2FsbHMpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICB2YXIgbGMgPSB0aGlzO1xyXG5cclxuICAgIGxjLnRyeUxvZ2luID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICBpZiAoIWxjLnVzZXIpIHtcclxuICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ05vIHNlIGhhIGludHJvZHVjaWRvIHVzdWFyaW8nLCAyMDAwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIWxjLnBhc3MpIHtcclxuICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdFbCBjYW1wbyBjb250cmFzZcOxYSBlcyBvYmxpZ2F0b3JpbycsIDIwMDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICRleHRlcm5hbENhbGxzLmdldFVzZXJCeVVzZXJuYW1lKGxjLnVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9nQW5kSnVtcClcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnRWwgdXN1YXJpbyBpbnRyb2R1Y2lkbyBubyBleGlzdGUnLCAyMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9nQW5kSnVtcCh1c2VyKSB7XHJcbiAgICAgICAgICAgIGlmIChsYy5wYXNzID09PSB1c2VyLnBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgICAgICAkdXNlcnNNYW5hZ2VyLnNldExvZ2dlZFVzZXIodXNlcik7XHJcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2luc2lkZS50aW1lbGluZScpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0xhIGNvbnRyYXNlw7FhIG5vIGVzIGNvcnJlY3RhJywgMjAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59IiwiaW1wb3J0ICcuLi8uLi90cmFuc3ZlcnNhbC91c2Vyc01hbmFnZXInO1xyXG5pbXBvcnQgJy4uLy4uL3RyYW5zdmVyc2FsL2V4dGVybmFsQ2FsbHMnO1xyXG5pbXBvcnQgY29uZmlnIGZyb20gJy4vY29uZmlnJztcclxuaW1wb3J0IGNvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVyJztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2NyZWRlbnRpYWxzLmxvZ2luJywgW1xyXG4gICAgICAgICd1aS5yb3V0ZXInLCAgICAgICAgXHJcbiAgICAgICAgJ3RyYW5zdmVyc2FsLnVzZXJzTWFuYWdlcicsXHJcbiAgICAgICAgJ3RyYW5zdmVyc2FsLmV4dGVybmFsQ2FsbHMnXHJcbiAgICBdKVxyXG4gICAgLmNvbmZpZyhjb25maWcpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgY29udHJvbGxlcik7IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBwaG90bzogJzwnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoKSB7fSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3NyYy9mZWF0dXJlcy9pbnNpZGUvY29tcG9uZW50cy9waG90b0luTGlzdC90ZW1wbGF0ZS5odG1sJ1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2luc2lkZScsIHtcclxuICAgICAgICB1cmw6ICcvaW5zaWRlJyxcclxuICAgICAgICBhYnN0cmFjdCA6IHRydWUsXHJcbiAgICAgICAgdGVtcGxhdGVVcmwgOiAnc3JjL2ZlYXR1cmVzL2luc2lkZS90ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyIDogJ0luc2lkZUNvbnRyb2xsZXIgYXMgaWMnXHJcbiAgICB9KVxyXG4gICAgXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgdmFyIGljID0gdGhpcztcclxufSIsImltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5pbXBvcnQgJy4vdGltZWxpbmUnXHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdpbnNpZGUnLCBbXHJcbiAgICAgICAgJ3VpLnJvdXRlcicsXHJcbiAgICAgICAgJ2luc2lkZS50aW1lbGluZScgICAgICAgIFxyXG4gICAgXSlcclxuICAgIC5jb25maWcoY29uZmlnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0luc2lkZUNvbnRyb2xsZXInLCBjb250cm9sbGVyKTsiLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaW5zaWRlLnRpbWVsaW5lJywge1xyXG4gICAgICAgIHVybDogJy90aW1lbGluZScsXHJcbiAgICAgICAgdGVtcGxhdGVVcmwgOiAnL3NyYy9mZWF0dXJlcy9pbnNpZGUvdGltZWxpbmUvdGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlciA6ICdUaW1lbGluZUNvbnRyb2xsZXIgYXMgdGMnXHJcbiAgICB9KVxyXG4gICAgXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJGV4dGVybmFsQ2FsbHMpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICB2YXIgdGMgPSB0aGlzO1xyXG4gICAgXHJcbiAgICB2YXIgX3BhZ2UgPSAxO1xyXG4gICAgXHJcbiAgICAvKnRjLnBob3RvcyA9IFt7XHJcbiAgICAgICAgdXNlcl9pZCA6ICdHYXN0bHknLFxyXG4gICAgICAgIGltYWdlIDogJ2ltZy9wcnVlYmEucG5nJyxcclxuICAgICAgICBsaWtlcyA6IDEyMyxcclxuICAgICAgICB0aXRsZSA6ICdCdWghJ1xyXG4gICAgfSwge1xyXG4gICAgICAgIHVzZXJfaWQgOiAnSGF1bnRlcicsXHJcbiAgICAgICAgaW1hZ2UgOiAnaW1nL2hhdW50ZXIucG5nJyxcclxuICAgICAgICBsaWtlcyA6IDMyMSxcclxuICAgICAgICB0aXRsZSA6ICdCdWgrKyEnXHJcbiAgICB9XTsqL1xyXG4gICAgXHJcbiAgICB0Yy5waG90b3MgPSAkZXh0ZXJuYWxDYWxscy5nZXRQaG90b3NUaW1lbGluZShfcGFnZSk7XHJcbiAgICBcclxuICAgIHRjLm1vcmVQaG90b3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgX3BhZ2UrKyxcclxuICAgICAgICB0Yy5waG90b3MucHVzaCgkZXh0ZXJuYWxDYWxscy5nZXRQaG90b3MoX3BhZ2UpKTtcclxuICAgIH1cclxufSIsImltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5pbXBvcnQgY29tcG9uZW50IGZyb20gJy4uL2NvbXBvbmVudHMvcGhvdG9Jbkxpc3QnO1xyXG5pbXBvcnQgJy4uLy4uL3RyYW5zdmVyc2FsL2V4dGVybmFsQ2FsbHMnXHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdpbnNpZGUudGltZWxpbmUnLCBbXHJcbiAgICAgICAgJ3VpLnJvdXRlcicsXHJcbiAgICAgICAgJ3RyYW5zdmVyc2FsLmV4dGVybmFsQ2FsbHMnXHJcbiAgICBdKVxyXG4gICAgLmNvbmZpZyhjb25maWcpXHJcbiAgICAuY29udHJvbGxlcignVGltZWxpbmVDb250cm9sbGVyJywgY29udHJvbGxlcilcclxuICAgIC5jb21wb25lbnQoJ2luc3RUaW1lUGhvdG8nLCBjb21wb25lbnQoKSk7IiwiaW1wb3J0IHNlcnZpY2UgZnJvbSAnLi9zZXJ2aWNlJztcclxuaW1wb3J0ICcuLi91c2Vyc01hbmFnZXInO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgndHJhbnN2ZXJzYWwuZXh0ZXJuYWxDYWxscycsIFtcclxuICAgICAgICAndHJhbnN2ZXJzYWwudXNlcnNNYW5hZ2VyJ1xyXG4gICAgXSlcclxuICAgIC5zZXJ2aWNlKCckZXh0ZXJuYWxDYWxscycsIHNlcnZpY2UpOyIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICgkdXNlcnNNYW5hZ2VyLCAkaHR0cCwgJHEpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICBcclxuICAgIHZhciBfdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MjIyMic7XHJcbiAgICBcclxuICAgIC8vIFJlY3VwZXJhIGZvdG9zIGNvbiBwYWdpbmFjaW9uLiBTZSBwYXNhbiBsb3MgZm9sbG93ZWQgcGFyYSBoYWNlciBqb2luLlxyXG4gICAgdGhpcy5nZXRQaG90b3NUaW1lbGluZSA9IGZ1bmN0aW9uKHBhZ2UpIHtcclxuICAgICAgICB2YXIgX3F1ID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgX3VzZXIgPSAkdXNlcnNNYW5hZ2VyLmdldExvZ2dlZFVzZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmwgOiBfdXJsICsgJy9waG90b3MnLFxyXG4gICAgICAgICAgICBtZXRob2QgOiAnR0VUJyxcclxuICAgICAgICAgICAgcGFyYW1zIDogeyBwYWdlIDogcGFnZSxcclxuICAgICAgICAgICAgICAgIHVzZXJpZCA6IF91c2VyLl9pZH1cclxuICAgICAgICB9KS50aGVuKGJhY2tQaG90b3NPSylcclxuICAgICAgICAuY2F0Y2goYmFja1Bob3Rvc1dyb25nKTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrUGhvdG9zT0socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICBfcXUucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9xdS5yZWplY3QoJ05vdGhpbmcgZm91bmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1Bob3Rvc1dyb25nKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF9xdS5yZWplY3QoJ0Vycm9yJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBfcXUucHJvbWlzZTsgICAgICAgIFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gUmVjdXBlcmEgdW4gdXN1YXJpbyBoYWNpZW5kbyB1c28gZGUgc3UgaWQgKGVuIHRhYmxhIGRlIG1vbmdvKVxyXG4gICAgdGhpcy5nZXRVc2VyQnlJZCA9IGZ1bmN0aW9uKGlkKXtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgX3F1ID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmwgOiBfdXJsICsgJy91c2Vycy8nKyBpZCxcclxuICAgICAgICAgICAgbWV0aG9kIDogJ0dFVCdcclxuICAgICAgICB9KS50aGVuKGJhY2tVc2VyT0spXHJcbiAgICAgICAgLmNhdGNoKGJhY2tVc2VyV3JvbmcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGJhY2tVc2VyT0socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICBfcXUucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9xdS5yZWplY3QoJ05vdGhpbmcgZm91bmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1VzZXJXcm9uZyhlcnJvcikge1xyXG4gICAgICAgICAgICBfcXUucmVqZWN0KCdFcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gX3F1LnByb21pc2U7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBSZWN1cGVyYSB1biB1c3VhcmlvIGhhY2llbmRvIHVzbyBkZSBzdSB1c2VybmFtZSBcclxuICAgIHRoaXMuZ2V0VXNlckJ5VXNlcm5hbWUgPSBmdW5jdGlvbih1c2VybmFtZSl7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIF9xdSA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmwgOiBfdXJsICsgJy91c2VycycsXHJcbiAgICAgICAgICAgIHBhcmFtcyA6IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBzdHJpY3QgOiBcInNcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtZXRob2QgOiAnR0VUJ1xyXG4gICAgICAgIH0pLnRoZW4oYmFja1VzZXJPSylcclxuICAgICAgICAuY2F0Y2goYmFja1VzZXJXcm9uZyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1VzZXJPSyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhKXtcclxuICAgICAgICAgICAgICAgIF9xdS5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3F1LnJlamVjdCgnTm90aGluZyBmb3VuZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrVXNlcldyb25nKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF9xdS5yZWplY3QoJ0Vycm9yJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBfcXUucHJvbWlzZTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFxyXG59IiwiaW1wb3J0IHNlcnZpY2UgZnJvbSAnLi9zZXJ2aWNlJztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ3RyYW5zdmVyc2FsLnVzZXJzTWFuYWdlcicsIFtdKVxyXG4gICAgLnNlcnZpY2UoJyR1c2Vyc01hbmFnZXInLCBzZXJ2aWNlKTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCkge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgIHZhciBfbG9nZ2VkO1xyXG5cclxuICAgIHRoaXMuc2V0TG9nZ2VkVXNlciA9IGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICBfbG9nZ2VkID0gdXNlcjtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRMb2dnZWRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIF9sb2dnZWQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMubG9nZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIF9sb2dnZWQgPSBudWxsO1xyXG4gICAgfVxyXG59Il19
