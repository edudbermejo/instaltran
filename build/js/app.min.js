(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

require('../features/credentials/login');

require('../features/inside');

angular.module('entry', ['credentials.login', 'inside']);

},{"../features/credentials/login":4,"../features/inside":8}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider, $urlRouterProvider) {
    'ngInject';

    $urlRouterProvider.otherwise('/login');

    $stateProvider.state('login', {
        url: '/login',
        templateUrl: 'src/features/credentials/login/template.html',
        controller: 'LoginController as lc'
    });
};

},{}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($usersManager, $state, $externalCalls) {
    'ngInject';

    var lc = this;

    lc.tryLogin = function () {

        if (!lc.user) {
            Materialize.toast('No se ha introducido usuario', 2000);
        } else {
            if (!lc.pass) {
                Materialize.toast('El campo contraseña es obligatorio', 2000);
            } else {

                $externalCalls.getUserByUsername(lc.user).then(logAndJump).catch(function () {
                    Materialize.toast('El usuario introducido no existe', 2000);
                });
            }
        }

        function logAndJump(user) {
            if (lc.pass === user.password) {
                $usersManager.setLoggedUser(user);
                $state.go('inside.timeline');
            } else {
                Materialize.toast('La contraseña no es correcta', 2000);
            }
        }
    };
};

},{}],4:[function(require,module,exports){
'use strict';

require('../../transversal/usersManager');

require('../../transversal/externalCalls');

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('credentials.login', ['ui.router', 'transversal.usersManager', 'transversal.externalCalls']).config(_config2.default).controller('LoginController', _controller2.default);

},{"../../transversal/externalCalls":12,"../../transversal/usersManager":14,"./config":2,"./controller":3}],5:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    return {
        bindings: {
            photo: '<'
        },
        controller: function controller() {},
        templateUrl: 'src/features/inside/components/photoInList/template.html'
    };
};

},{}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('inside', {
        url: '/inside',
        abstract: true,
        templateUrl: 'src/features/inside/template.html',
        controller: 'InsideController as ic'
    });
};

},{}],7:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    'ngInject';

    var ic = this;
};

},{}],8:[function(require,module,exports){
'use strict';

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

require('./timeline');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('inside', ['ui.router', 'inside.timeline']).config(_config2.default).controller('InsideController', _controller2.default);

},{"./config":6,"./controller":7,"./timeline":11}],9:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('inside.timeline', {
        url: '/timeline',
        templateUrl: '/src/features/inside/timeline/template.html',
        controller: 'TimelineController as tc'
    });
};

},{}],10:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($externalCalls) {
    'ngInject';

    var tc = this;

    var _page = 1;

    /*tc.photos = [{
        user_id : 'Gastly',
        image : 'img/prueba.png',
        likes : 123,
        title : 'Buh!'
    }, {
        user_id : 'Haunter',
        image : 'img/haunter.png',
        likes : 321,
        title : 'Buh++!'
    }];*/

    tc.photos = $externalCalls.getPhotosTimeline(_page);

    tc.morePhotos = function () {
        _page++, tc.photos.push($externalCalls.getPhotos(_page));
    };
};

},{}],11:[function(require,module,exports){
'use strict';

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

var _photoInList = require('../components/photoInList');

var _photoInList2 = _interopRequireDefault(_photoInList);

require('../../transversal/externalCalls');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('inside.timeline', ['ui.router', 'transversal.externalCalls']).config(_config2.default).controller('TimelineController', _controller2.default).component('instTimePhoto', (0, _photoInList2.default)());

},{"../../transversal/externalCalls":12,"../components/photoInList":5,"./config":9,"./controller":10}],12:[function(require,module,exports){
'use strict';

var _service = require('./service');

var _service2 = _interopRequireDefault(_service);

require('../usersManager');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('transversal.externalCalls', ['transversal.usersManager']).service('$externalCalls', _service2.default);

},{"../usersManager":14,"./service":13}],13:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($usersManager, $http, $q) {
    'ngInject';

    var _url = 'http://localhost:2222';

    // Recupera fotos con paginacion. Se pasan los followed para hacer join.
    this.getPhotosTimeline = function (page) {
        var _qu = $q.defer();

        var _data = $usersManager.getLoggedUser().followed;

        return $http({
            url: _url + '/photos',
            method: 'GET',
            params: { page: page },
            data: { followed: _data }
        }).then(backPhotosOK).catch(backPhotosWrong);

        function backPhotosOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backPhotosWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    // Recupera un usuario haciendo uso de su id (en tabla de mongo)
    this.getUserById = function (id) {

        var _qu = $q.defer();

        return $http({
            url: _url + '/users/' + id,
            method: 'GET'
        }).then(backUserOK).catch(backUserWrong);

        function backUserOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backUserWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    // Recupera un usuario haciendo uso de su username
    this.getUserByUsername = function (username) {

        var _qu = $q.defer();

        $http({
            url: _url + '/users',
            params: {
                username: username,
                strict: "s"
            },
            method: 'GET'
        }).then(backUserOK).catch(backUserWrong);

        function backUserOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backUserWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };
};

},{}],14:[function(require,module,exports){
'use strict';

var _service = require('./service');

var _service2 = _interopRequireDefault(_service);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('transversal.usersManager', []).service('$usersManager', _service2.default);

},{"./service":15}],15:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    'ngInject';

    var _logged;

    this.setLoggedUser = function (user) {
        _logged = user;
    };

    this.getLoggedUser = function () {
        return _logged;
    };

    this.loggout = function () {
        _logged = null;
    };
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcY3JlZGVudGlhbHNcXGxvZ2luXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xcbG9naW5cXGNvbnRyb2xsZXIuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xcbG9naW5cXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcaW5zaWRlXFxjb21wb25lbnRzXFxwaG90b0luTGlzdFxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXGNvbmZpZy5qcyIsInNyY1xcZmVhdHVyZXNcXGluc2lkZVxcY29udHJvbGxlci5qcyIsInNyY1xcZmVhdHVyZXNcXGluc2lkZVxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHRpbWVsaW5lXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHRpbWVsaW5lXFxjb250cm9sbGVyLmpzIiwic3JjXFxmZWF0dXJlc1xcaW5zaWRlXFx0aW1lbGluZVxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFx0cmFuc3ZlcnNhbFxcZXh0ZXJuYWxDYWxsc1xcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFx0cmFuc3ZlcnNhbFxcZXh0ZXJuYWxDYWxsc1xcc2VydmljZS5qcyIsInNyY1xcZmVhdHVyZXNcXHRyYW5zdmVyc2FsXFx1c2Vyc01hbmFnZXJcXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcdHJhbnN2ZXJzYWxcXHVzZXJzTWFuYWdlclxcc2VydmljZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQ0dBLFFBQ0ssTUFETCxDQUNZLE9BRFosRUFDcUIsQ0FDYixtQkFEYSxFQUViLFFBRmEsQ0FEckI7Ozs7Ozs7OztrQkNIZSxVQUFVLGNBQVYsRUFBMEIsa0JBQTFCLEVBQThDO0FBQ3pELGVBRHlEOztBQUV6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QXNCdkMsaUJBQVMsYUFBVCxDQUF1QixLQUF2QixFQUE4QjtBQUMxQixnQkFBSSxNQUFKLENBQVcsT0FBWCxFQUQwQjtTQUE5Qjs7QUFJQSxlQUFPLElBQUksT0FBSixDQTFCZ0M7S0FBbEIsQ0E3RHNCO0NBQXBDOzs7Ozs7Ozs7OztBQ0VmLFFBQ0ssTUFETCxDQUNZLDBCQURaLEVBQ3dDLEVBRHhDLEVBRUssT0FGTCxDQUVhLGVBRmI7Ozs7Ozs7OztrQkNGZSxZQUFZO0FBQ3ZCLGVBRHVCOztBQUV2QixRQUFJLE9BQUosQ0FGdUI7O0FBSXZCLFNBQUssYUFBTCxHQUFxQixVQUFTLElBQVQsRUFBZTtBQUNoQyxrQkFBVSxJQUFWLENBRGdDO0tBQWYsQ0FKRTs7QUFRdkIsU0FBSyxhQUFMLEdBQXFCLFlBQVc7QUFDNUIsZUFBTyxPQUFQLENBRDRCO0tBQVgsQ0FSRTs7QUFZdkIsU0FBSyxPQUFMLEdBQWUsWUFBVztBQUN0QixrQkFBVSxJQUFWLENBRHNCO0tBQVgsQ0FaUTtDQUFaIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCAnLi4vZmVhdHVyZXMvY3JlZGVudGlhbHMvbG9naW4nO1xyXG5pbXBvcnQgJy4uL2ZlYXR1cmVzL2luc2lkZSdcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2VudHJ5JywgW1xyXG4gICAgICAgICdjcmVkZW50aWFscy5sb2dpbicsXHJcbiAgICAgICAgJ2luc2lkZSdcclxuICAgIF0pOyIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XHJcblxyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgIHVybDogJy9sb2dpbicsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdzcmMvZmVhdHVyZXMvY3JlZGVudGlhbHMvbG9naW4vdGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlciBhcyBsYydcclxuICAgIH0pXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHVzZXJzTWFuYWdlciwgJHN0YXRlLCAkZXh0ZXJuYWxDYWxscykge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgIHZhciBsYyA9IHRoaXM7XHJcblxyXG4gICAgbGMudHJ5TG9naW4gPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIGlmICghbGMudXNlcikge1xyXG4gICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnTm8gc2UgaGEgaW50cm9kdWNpZG8gdXN1YXJpbycsIDIwMDApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghbGMucGFzcykge1xyXG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0VsIGNhbXBvIGNvbnRyYXNlw7FhIGVzIG9ibGlnYXRvcmlvJywgMjAwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJGV4dGVybmFsQ2FsbHMuZ2V0VXNlckJ5VXNlcm5hbWUobGMudXNlcilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihsb2dBbmRKdW1wKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdFbCB1c3VhcmlvIGludHJvZHVjaWRvIG5vIGV4aXN0ZScsIDIwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2dBbmRKdW1wKHVzZXIpIHtcclxuICAgICAgICAgICAgaWYgKGxjLnBhc3MgPT09IHVzZXIucGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgICAgICR1c2Vyc01hbmFnZXIuc2V0TG9nZ2VkVXNlcih1c2VyKTtcclxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaW5zaWRlLnRpbWVsaW5lJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnTGEgY29udHJhc2XDsWEgbm8gZXMgY29ycmVjdGEnLCAyMDAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0iLCJpbXBvcnQgJy4uLy4uL3RyYW5zdmVyc2FsL3VzZXJzTWFuYWdlcic7XHJcbmltcG9ydCAnLi4vLi4vdHJhbnN2ZXJzYWwvZXh0ZXJuYWxDYWxscyc7XHJcbmltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnY3JlZGVudGlhbHMubG9naW4nLCBbXHJcbiAgICAgICAgJ3VpLnJvdXRlcicsICAgICAgICBcclxuICAgICAgICAndHJhbnN2ZXJzYWwudXNlcnNNYW5hZ2VyJyxcclxuICAgICAgICAndHJhbnN2ZXJzYWwuZXh0ZXJuYWxDYWxscydcclxuICAgIF0pXHJcbiAgICAuY29uZmlnKGNvbmZpZylcclxuICAgIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBjb250cm9sbGVyKTsiLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgIHBob3RvOiAnPCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uICgpIHt9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnc3JjL2ZlYXR1cmVzL2luc2lkZS9jb21wb25lbnRzL3Bob3RvSW5MaXN0L3RlbXBsYXRlLmh0bWwnXHJcbiAgICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaW5zaWRlJywge1xyXG4gICAgICAgIHVybDogJy9pbnNpZGUnLFxyXG4gICAgICAgIGFic3RyYWN0IDogdHJ1ZSxcclxuICAgICAgICB0ZW1wbGF0ZVVybCA6ICdzcmMvZmVhdHVyZXMvaW5zaWRlL3RlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXIgOiAnSW5zaWRlQ29udHJvbGxlciBhcyBpYydcclxuICAgIH0pXHJcbiAgICBcclxufSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICgpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICB2YXIgaWMgPSB0aGlzO1xyXG59IiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuL2NvbmZpZyc7XHJcbmltcG9ydCBjb250cm9sbGVyIGZyb20gJy4vY29udHJvbGxlcic7XHJcbmltcG9ydCAnLi90aW1lbGluZSdcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2luc2lkZScsIFtcclxuICAgICAgICAndWkucm91dGVyJyxcclxuICAgICAgICAnaW5zaWRlLnRpbWVsaW5lJyAgICAgICAgXHJcbiAgICBdKVxyXG4gICAgLmNvbmZpZyhjb25maWcpXHJcbiAgICAuY29udHJvbGxlcignSW5zaWRlQ29udHJvbGxlcicsIGNvbnRyb2xsZXIpOyIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdpbnNpZGUudGltZWxpbmUnLCB7XHJcbiAgICAgICAgdXJsOiAnL3RpbWVsaW5lJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybCA6ICcvc3JjL2ZlYXR1cmVzL2luc2lkZS90aW1lbGluZS90ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyIDogJ1RpbWVsaW5lQ29udHJvbGxlciBhcyB0YydcclxuICAgIH0pXHJcbiAgICBcclxufSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICgkZXh0ZXJuYWxDYWxscykge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgIHZhciB0YyA9IHRoaXM7XHJcbiAgICBcclxuICAgIHZhciBfcGFnZSA9IDE7XHJcbiAgICBcclxuICAgIC8qdGMucGhvdG9zID0gW3tcclxuICAgICAgICB1c2VyX2lkIDogJ0dhc3RseScsXHJcbiAgICAgICAgaW1hZ2UgOiAnaW1nL3BydWViYS5wbmcnLFxyXG4gICAgICAgIGxpa2VzIDogMTIzLFxyXG4gICAgICAgIHRpdGxlIDogJ0J1aCEnXHJcbiAgICB9LCB7XHJcbiAgICAgICAgdXNlcl9pZCA6ICdIYXVudGVyJyxcclxuICAgICAgICBpbWFnZSA6ICdpbWcvaGF1bnRlci5wbmcnLFxyXG4gICAgICAgIGxpa2VzIDogMzIxLFxyXG4gICAgICAgIHRpdGxlIDogJ0J1aCsrISdcclxuICAgIH1dOyovXHJcbiAgICBcclxuICAgIHRjLnBob3RvcyA9ICRleHRlcm5hbENhbGxzLmdldFBob3Rvc1RpbWVsaW5lKF9wYWdlKTtcclxuICAgIFxyXG4gICAgdGMubW9yZVBob3RvcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBfcGFnZSsrLFxyXG4gICAgICAgIHRjLnBob3Rvcy5wdXNoKCRleHRlcm5hbENhbGxzLmdldFBob3RvcyhfcGFnZSkpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuL2NvbmZpZyc7XHJcbmltcG9ydCBjb250cm9sbGVyIGZyb20gJy4vY29udHJvbGxlcic7XHJcbmltcG9ydCBjb21wb25lbnQgZnJvbSAnLi4vY29tcG9uZW50cy9waG90b0luTGlzdCc7XHJcbmltcG9ydCAnLi4vLi4vdHJhbnN2ZXJzYWwvZXh0ZXJuYWxDYWxscydcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2luc2lkZS50aW1lbGluZScsIFtcclxuICAgICAgICAndWkucm91dGVyJyxcclxuICAgICAgICAndHJhbnN2ZXJzYWwuZXh0ZXJuYWxDYWxscydcclxuICAgIF0pXHJcbiAgICAuY29uZmlnKGNvbmZpZylcclxuICAgIC5jb250cm9sbGVyKCdUaW1lbGluZUNvbnRyb2xsZXInLCBjb250cm9sbGVyKVxyXG4gICAgLmNvbXBvbmVudCgnaW5zdFRpbWVQaG90bycsIGNvbXBvbmVudCgpKTsiLCJpbXBvcnQgc2VydmljZSBmcm9tICcuL3NlcnZpY2UnO1xyXG5pbXBvcnQgJy4uL3VzZXJzTWFuYWdlcic7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCd0cmFuc3ZlcnNhbC5leHRlcm5hbENhbGxzJywgW1xyXG4gICAgICAgICd0cmFuc3ZlcnNhbC51c2Vyc01hbmFnZXInXHJcbiAgICBdKVxyXG4gICAgLnNlcnZpY2UoJyRleHRlcm5hbENhbGxzJywgc2VydmljZSk7IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCR1c2Vyc01hbmFnZXIsICRodHRwLCAkcSkge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgIFxyXG4gICAgdmFyIF91cmwgPSAnaHR0cDovL2xvY2FsaG9zdDoyMjIyJztcclxuICAgIFxyXG4gICAgLy8gUmVjdXBlcmEgZm90b3MgY29uIHBhZ2luYWNpb24uIFNlIHBhc2FuIGxvcyBmb2xsb3dlZCBwYXJhIGhhY2VyIGpvaW4uXHJcbiAgICB0aGlzLmdldFBob3Rvc1RpbWVsaW5lID0gZnVuY3Rpb24ocGFnZSkge1xyXG4gICAgICAgIHZhciBfcXUgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBfZGF0YSA9ICR1c2Vyc01hbmFnZXIuZ2V0TG9nZ2VkVXNlcigpLmZvbGxvd2VkO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiAkaHR0cCh7XHJcbiAgICAgICAgICAgIHVybCA6IF91cmwgKyAnL3Bob3RvcycsXHJcbiAgICAgICAgICAgIG1ldGhvZCA6ICdHRVQnLFxyXG4gICAgICAgICAgICBwYXJhbXMgOiB7IHBhZ2UgOiBwYWdlfSxcclxuICAgICAgICAgICAgZGF0YSA6IHsgZm9sbG93ZWQgOl9kYXRhIH1cclxuICAgICAgICB9KS50aGVuKGJhY2tQaG90b3NPSylcclxuICAgICAgICAuY2F0Y2goYmFja1Bob3Rvc1dyb25nKTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrUGhvdG9zT0socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICBfcXUucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9xdS5yZWplY3QoJ05vdGhpbmcgZm91bmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1Bob3Rvc1dyb25nKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF9xdS5yZWplY3QoJ0Vycm9yJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBfcXUucHJvbWlzZTsgICAgICAgIFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gUmVjdXBlcmEgdW4gdXN1YXJpbyBoYWNpZW5kbyB1c28gZGUgc3UgaWQgKGVuIHRhYmxhIGRlIG1vbmdvKVxyXG4gICAgdGhpcy5nZXRVc2VyQnlJZCA9IGZ1bmN0aW9uKGlkKXtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgX3F1ID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmwgOiBfdXJsICsgJy91c2Vycy8nKyBpZCxcclxuICAgICAgICAgICAgbWV0aG9kIDogJ0dFVCdcclxuICAgICAgICB9KS50aGVuKGJhY2tVc2VyT0spXHJcbiAgICAgICAgLmNhdGNoKGJhY2tVc2VyV3JvbmcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGJhY2tVc2VyT0socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICBfcXUucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF9xdS5yZWplY3QoJ05vdGhpbmcgZm91bmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1VzZXJXcm9uZyhlcnJvcikge1xyXG4gICAgICAgICAgICBfcXUucmVqZWN0KCdFcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gX3F1LnByb21pc2U7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBSZWN1cGVyYSB1biB1c3VhcmlvIGhhY2llbmRvIHVzbyBkZSBzdSB1c2VybmFtZSBcclxuICAgIHRoaXMuZ2V0VXNlckJ5VXNlcm5hbWUgPSBmdW5jdGlvbih1c2VybmFtZSl7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIF9xdSA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmwgOiBfdXJsICsgJy91c2VycycsXHJcbiAgICAgICAgICAgIHBhcmFtcyA6IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lIDogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBzdHJpY3QgOiBcInNcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtZXRob2QgOiAnR0VUJ1xyXG4gICAgICAgIH0pLnRoZW4oYmFja1VzZXJPSylcclxuICAgICAgICAuY2F0Y2goYmFja1VzZXJXcm9uZyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1VzZXJPSyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhKXtcclxuICAgICAgICAgICAgICAgIF9xdS5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3F1LnJlamVjdCgnTm90aGluZyBmb3VuZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrVXNlcldyb25nKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF9xdS5yZWplY3QoJ0Vycm9yJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBfcXUucHJvbWlzZTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFxyXG59IiwiaW1wb3J0IHNlcnZpY2UgZnJvbSAnLi9zZXJ2aWNlJztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ3RyYW5zdmVyc2FsLnVzZXJzTWFuYWdlcicsIFtdKVxyXG4gICAgLnNlcnZpY2UoJyR1c2Vyc01hbmFnZXInLCBzZXJ2aWNlKTtcclxuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCkge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgIHZhciBfbG9nZ2VkO1xyXG5cclxuICAgIHRoaXMuc2V0TG9nZ2VkVXNlciA9IGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICBfbG9nZ2VkID0gdXNlcjtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRMb2dnZWRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIF9sb2dnZWQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMubG9nZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIF9sb2dnZWQgPSBudWxsO1xyXG4gICAgfVxyXG59Il19
