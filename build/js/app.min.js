(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

require('../features/credentials/login');

require('../features/inside');

require('../features/credentials/register');

angular.module('entry', ['credentials.login', 'credentials.register', 'inside']);

},{"../features/credentials/login":4,"../features/credentials/register":7,"../features/inside":11}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider, $urlRouterProvider) {
    'ngInject';

    $urlRouterProvider.otherwise('/login');

    $stateProvider.state('login', {
        url: '/login',
        templateUrl: 'src/features/credentials/login/template.html',
        controller: 'LoginController as lc'
    });
};

},{}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($usersManager, $state, $externalCalls) {
    'ngInject';

    var lc = this;

    lc.tryLogin = function () {

        if (!lc.user) {
            Materialize.toast('No se ha introducido usuario', 2000);
        } else {
            if (!lc.pass) {
                Materialize.toast('El campo contraseña es obligatorio', 2000);
            } else {

                $externalCalls.getUserByUsername(lc.user).then(logAndJump).catch(function () {
                    Materialize.toast('El usuario introducido no existe', 2000);
                });
            }
        }

        function logAndJump(user) {
            if (lc.pass === user.password) {
                $usersManager.setLoggedUser(user);
                $state.go('inside.timeline');
            } else {
                Materialize.toast('La contraseña no es correcta', 2000);
            }
        }
    };

    lc.goRegister = function () {
        $state.go('register');
    };
};

},{}],4:[function(require,module,exports){
'use strict';

require('../../transversal/usersManager');

require('../../transversal/externalCalls');

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('credentials.login', ['ui.router', 'transversal.usersManager', 'transversal.externalCalls']).config(_config2.default).controller('LoginController', _controller2.default);

},{"../../transversal/externalCalls":18,"../../transversal/usersManager":20,"./config":2,"./controller":3}],5:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('register', {
        url: '/register',
        templateUrl: 'src/features/credentials/register/template.html',
        controller: 'RegisterController as rc'
    });
};

},{}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($state, $externalCalls) {
    'ngInject';

    var rc = this;

    rc.tryRegister = function () {

        if (!rc.user) {
            Materialize.toast('No se ha introducido usuario', 2000);
        } else {
            if (!rc.pass) {
                Materialize.toast('El campo contraseña es obligatorio', 2000);
            } else {

                if (!rc.passre) {
                    Materialize.toast('Repita la contraseña', 2000);
                } else {

                    if (rc.pass !== rc.passre) {

                        Materialize.toast('Las contraseñas no coinciden', 2000);
                    } else {

                        var _username = rc.user.toLowerCase();
                        console.log(_username);
                        $externalCalls.getUserByUsername(_username).then(keepTryingRegister);
                    }
                }
            }
        }

        function keepTryingRegister(user) {
            if (user) {
                Materialize.toast('Ya existe ese nombre de usuario', 2000);
            } else {
                $externalCalls.postUser(_username, rc.pass).then(finishing);
            };

            function finishing() {
                Materialize.toast('Usuario creado correctamente', 1500, '', function () {
                    $state.go('login');
                });
            }
        }
    };
};

},{}],7:[function(require,module,exports){
'use strict';

require('../../transversal/usersManager');

require('../../transversal/externalCalls');

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('credentials.register', ['ui.router', 'transversal.externalCalls']).config(_config2.default).controller('RegisterController', _controller2.default);

},{"../../transversal/externalCalls":18,"../../transversal/usersManager":20,"./config":5,"./controller":6}],8:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    return {
        bindings: {
            photo: '<'
        },
        controller: function controller() {},
        templateUrl: 'src/features/inside/components/photoInList/template.html'
    };
};

},{}],9:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('inside', {
        url: '/inside',
        abstract: true,
        templateUrl: 'src/features/inside/template.html',
        controller: 'InsideController as ic'
    });
};

},{}],10:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($state, $usersManager) {
    'ngInject';

    var ic = this;
    var _darkBackground = "col s6 center-align green darken-3";
    var _lightBackground = "col s6 center-align light-green accent-1";
    var _darkIcon = "material-icons medium light-green-text text-darken-4";
    var _lightIcon = "material-icons medium light-green-text text-lighten-4";

    ic.classTimelineBackground = _darkBackground;
    ic.classTimelineIcon = _lightIcon;
    ic.classSharePhotoBackground = _lightBackground;
    ic.classSharePhotoIcon = _darkIcon;

    ic.goTimeline = function () {
        ic.classTimelineBackground = _darkBackground;
        ic.classTimelineIcon = _lightIcon;
        ic.classSharePhotoBackground = _lightBackground;
        ic.classSharePhotoIcon = _darkIcon;
        $state.go('^.timeline');
    };

    ic.goSharePhoto = function () {
        ic.classTimelineBackground = _lightBackground;
        ic.classTimelineIcon = _darkIcon;
        ic.classSharePhotoBackground = _darkBackground;
        ic.classSharePhotoIcon = _lightIcon;
        $state.go('^.sharephoto');
    };

    ic.loggout = function () {
        $usersManager.loggout();
        $state.go('login');
    };
};

},{}],11:[function(require,module,exports){
'use strict';

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

require('./timeline');

require('./share-photo');

require('../transversal/usersManager');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('inside', ['ui.router', 'inside.timeline', 'inside.sharePhoto', 'transversal.usersManager']).config(_config2.default).controller('InsideController', _controller2.default);

},{"../transversal/usersManager":20,"./config":9,"./controller":10,"./share-photo":14,"./timeline":17}],12:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('inside.sharephoto', {
        url: '/sharephoto',
        templateUrl: '/src/features/inside/share-photo/template.html',
        controller: 'SharePhotoController as spc'
    });
};

},{}],13:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($externalCalls, $state) {
    'ngInject';

    var spc = this;

    spc.upPhoto = function () {

        if (!spc.imgUrl) {
            Materialize.toast('No se ha introducido una ruta', 2000);
        } else {
            $externalCalls.postPhoto(spc.imgUrl, spc.title).then(function () {
                $state.go('inside.timeline');
            }).catch(function () {
                Materialize.toast('Ocurrio un problema. Intentalo mas tarde', 2000);
            });
        }
    };
};

},{}],14:[function(require,module,exports){
'use strict';

require('../../transversal/externalCalls');

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('inside.sharePhoto', ['transversal.externalCalls']).config(_config2.default).controller('SharePhotoController', _controller2.default);

},{"../../transversal/externalCalls":18,"./config":12,"./controller":13}],15:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($stateProvider) {
    'ngInject';

    $stateProvider.state('inside.timeline', {
        url: '/timeline',
        templateUrl: '/src/features/inside/timeline/template.html',
        controller: 'TimelineController as tc'
    });
};

},{}],16:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($externalCalls) {
    'ngInject';

    var tc = this;

    var _page = 1;

    /*tc.photos = [{
        user_id : 'Gastly',
        image : 'img/prueba.png',
        likes : 123,
        title : 'Buh!'
    }, {
        user_id : 'Haunter',
        image : 'img/haunter.png',
        likes : 321,
        title : 'Buh++!'
    }];*/

    $externalCalls.getPhotosTimeline(_page).then(function (response) {
        console.log(response);
        tc.photos = response;
    });

    tc.morePhotos = function () {
        _page++, tc.photos.push($externalCalls.getPhotos(_page));
    };
};

},{}],17:[function(require,module,exports){
'use strict';

var _config = require('./config');

var _config2 = _interopRequireDefault(_config);

var _controller = require('./controller');

var _controller2 = _interopRequireDefault(_controller);

var _photoInList = require('../components/photoInList');

var _photoInList2 = _interopRequireDefault(_photoInList);

require('../../transversal/externalCalls');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('inside.timeline', ['ui.router', 'transversal.externalCalls']).config(_config2.default).controller('TimelineController', _controller2.default).component('instTimePhoto', (0, _photoInList2.default)());

},{"../../transversal/externalCalls":18,"../components/photoInList":8,"./config":15,"./controller":16}],18:[function(require,module,exports){
'use strict';

var _service = require('./service');

var _service2 = _interopRequireDefault(_service);

require('../usersManager');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('transversal.externalCalls', ['transversal.usersManager']).service('$externalCalls', _service2.default);

},{"../usersManager":20,"./service":19}],19:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function ($usersManager, $http, $q) {
    'ngInject';

    var _url = 'http://localhost:2222';

    // Recupera fotos con paginacion. Se pasan los followed para hacer join.
    this.getPhotosTimeline = function (page) {
        var _qu = $q.defer();

        var _user = $usersManager.getLoggedUser();

        $http({
            url: _url + '/photos',
            method: 'GET',
            params: { page: page,
                userid: _user._id }
        }).then(backPhotosOK).catch(backPhotosWrong);

        function backPhotosOK(response) {
            if (response.data) {
                _qu.resolve(response.data.docs);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backPhotosWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    // Recupera un usuario haciendo uso de su id (en tabla de mongo)
    this.getUserById = function (id) {

        var _qu = $q.defer();

        return $http({
            url: _url + '/users/' + id,
            method: 'GET'
        }).then(backUserOK).catch(backUserWrong);

        function backUserOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.reject('Nothing found');
            }
        };

        function backUserWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    // Recupera un usuario haciendo uso de su username
    this.getUserByUsername = function (username) {

        var _qu = $q.defer();

        $http({
            url: _url + '/users',
            params: {
                username: username,
                strict: "s"
            },
            method: 'GET'
        }).then(backUserOK).catch(backUserWrong);

        function backUserOK(response) {
            if (response.data) {
                _qu.resolve(response.data);
            } else {
                _qu.resolve(null);
            }
        };

        function backUserWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    this.postPhoto = function (url, title) {

        var _qu = $q.defer();

        var _user = $usersManager.getLoggedUser();

        $http({
            url: _url + '/photos',
            data: {
                image: url,
                user: _user.username,
                user_id: _user._id,
                title: title
            },
            method: 'POST'
        }).then(upPhotoOK).catch(upPhotoWrong);

        function upPhotoOK(response) {
            _qu.resolve(response.data);
        };

        function upPhotoWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };

    this.postUser = function (username, password) {

        var _qu = $q.defer();

        $http({
            url: _url + '/users',
            data: {
                username: username,
                password: password
            },
            method: 'POST'
        }).then(upUserOK).catch(upUserWrong);

        function upUserOK(response) {
            _qu.resolve(response.data);
        };

        function upUserWrong(error) {
            _qu.reject('Error');
        }

        return _qu.promise;
    };
};

},{}],20:[function(require,module,exports){
'use strict';

var _service = require('./service');

var _service2 = _interopRequireDefault(_service);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

angular.module('transversal.usersManager', []).service('$usersManager', _service2.default);

},{"./service":21}],21:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    'ngInject';

    var _logged;

    this.setLoggedUser = function (user) {
        _logged = angular.copy(user);
    };

    this.getLoggedUser = function () {
        return _logged;
    };

    this.loggout = function () {
        _logged = null;
    };
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcY3JlZGVudGlhbHNcXGxvZ2luXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xcbG9naW5cXGNvbnRyb2xsZXIuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xcbG9naW5cXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcY3JlZGVudGlhbHNcXHJlZ2lzdGVyXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xccmVnaXN0ZXJcXGNvbnRyb2xsZXIuanMiLCJzcmNcXGZlYXR1cmVzXFxjcmVkZW50aWFsc1xccmVnaXN0ZXJcXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcaW5zaWRlXFxjb21wb25lbnRzXFxwaG90b0luTGlzdFxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXGNvbmZpZy5qcyIsInNyY1xcZmVhdHVyZXNcXGluc2lkZVxcY29udHJvbGxlci5qcyIsInNyY1xcZmVhdHVyZXNcXGluc2lkZVxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHNoYXJlLXBob3RvXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHNoYXJlLXBob3RvXFxjb250cm9sbGVyLmpzIiwic3JjXFxmZWF0dXJlc1xcaW5zaWRlXFxzaGFyZS1waG90b1xcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHRpbWVsaW5lXFxjb25maWcuanMiLCJzcmNcXGZlYXR1cmVzXFxpbnNpZGVcXHRpbWVsaW5lXFxjb250cm9sbGVyLmpzIiwic3JjXFxmZWF0dXJlc1xcaW5zaWRlXFx0aW1lbGluZVxcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFx0cmFuc3ZlcnNhbFxcZXh0ZXJuYWxDYWxsc1xcaW5kZXguanMiLCJzcmNcXGZlYXR1cmVzXFx0cmFuc3ZlcnNhbFxcZXh0ZXJuYWxDYWxsc1xcc2VydmljZS5qcyIsInNyY1xcZmVhdHVyZXNcXHRyYW5zdmVyc2FsXFx1c2Vyc01hbmFnZXJcXGluZGV4LmpzIiwic3JjXFxmZWF0dXJlc1xcdHJhbnN2ZXJzYWxcXHVzZXJzTWFuYWdlclxcc2VydmljZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7O0FDSUEsUUFDSyxNQURMLENBQ1ksT0FEWixFQUNxQixDQUNiLG1CQURhLEVBRWIsc0JBRmEsRUFHYixRQUhhLENBRHJCOzs7Ozs7Ozs7a0JDSmUsVUFBVSxjQUFWLEVBQTBCLGtCQUExQixFQUE4QztBQUN6RCxlQUR5RDs7QUFFekQsdUJBQW1CLFNBQW5CLENBQTZCLFFBQTdCLEVBRnlEOztBQUl6RCxtQkFBZSxLQUFmLENBQXFCLE9BQXJCLEVBQThCO0FBQzFCLGFBQUssUUFBTDtBQUNBLHFCQUFhLDhDQUFiO0FBQ0Esb0JBQVksdUJBQVo7S0FISixFQUp5RDtDQUE5Qzs7Ozs7Ozs7O2tCQ0FBLFVBQVUsYUFBVixFQUF5QixNQUF6QixFQUFpQyxjQUFqQyxFQUFpRDtBQUM1RCxlQUQ0RDs7QUFFNUQsUUFBSSxLQUFLLElBQUwsQ0FGd0Q7O0FBSTVELE9BQUcsUUFBSCxHQUFjLFlBQVk7O0FBRXRCLFlBQUksQ0FBQyxHQUFHLElBQUgsRUFBUztBQUNWLHdCQUFZLEtBQVosQ0FBa0IsOEJBQWxCLEVBQWtELElBQWxELEVBRFU7U0FBZCxNQUVPO0FBQ0gsZ0JBQUksQ0FBQyxHQUFHLElBQUgsRUFBUztBQUNWLDRCQUFZLEtBQVosQ0FBa0Isb0NBQWxCLEVBQXdELElBQXhELEVBRFU7YUFBZCxNQUVPOztBQUVILCtCQUFlLGlCQUFmLENBQWlDLEdBQUcsSUFBSCxDQUFqQyxDQUNLLElBREwsQ0FDVSxVQURWLEVBRUssS0FGTCxDQUVXLFlBQVk7QUFDZixnQ0FBWSxLQUFaLENBQWtCLGtDQUFsQixFQUFzRCxJQUF0RCxFQURlO2lCQUFaLENBRlgsQ0FGRzthQUZQO1NBSEo7O0FB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VixDQUQrQjtLQUFmLENBSkU7O0FBUXZCLFNBQUssYUFBTCxHQUFxQixZQUFXO0FBQzVCLGVBQU8sT0FBUCxDQUQ0QjtLQUFYLENBUkU7O0FBWXZCLFNBQUssT0FBTCxHQUFlLFlBQVc7QUFDdEIsa0JBQVUsSUFBVixDQURzQjtLQUFYLENBWlE7Q0FBWiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgJy4uL2ZlYXR1cmVzL2NyZWRlbnRpYWxzL2xvZ2luJztcclxuaW1wb3J0ICcuLi9mZWF0dXJlcy9pbnNpZGUnO1xyXG5pbXBvcnQgJy4uL2ZlYXR1cmVzL2NyZWRlbnRpYWxzL3JlZ2lzdGVyJztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2VudHJ5JywgW1xyXG4gICAgICAgICdjcmVkZW50aWFscy5sb2dpbicsXHJcbiAgICAgICAgJ2NyZWRlbnRpYWxzLnJlZ2lzdGVyJyxcclxuICAgICAgICAnaW5zaWRlJ1xyXG4gICAgXSk7IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvbG9naW4nKTtcclxuXHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbG9naW4nLCB7XHJcbiAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3NyYy9mZWF0dXJlcy9jcmVkZW50aWFscy9sb2dpbi90ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyIGFzIGxjJ1xyXG4gICAgfSlcclxufSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uICgkdXNlcnNNYW5hZ2VyLCAkc3RhdGUsICRleHRlcm5hbENhbGxzKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgdmFyIGxjID0gdGhpcztcclxuXHJcbiAgICBsYy50cnlMb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgaWYgKCFsYy51c2VyKSB7XHJcbiAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdObyBzZSBoYSBpbnRyb2R1Y2lkbyB1c3VhcmlvJywgMjAwMCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKCFsYy5wYXNzKSB7XHJcbiAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnRWwgY2FtcG8gY29udHJhc2XDsWEgZXMgb2JsaWdhdG9yaW8nLCAyMDAwKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkZXh0ZXJuYWxDYWxscy5nZXRVc2VyQnlVc2VybmFtZShsYy51c2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGxvZ0FuZEp1bXApXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0VsIHVzdWFyaW8gaW50cm9kdWNpZG8gbm8gZXhpc3RlJywgMjAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvZ0FuZEp1bXAodXNlcikge1xyXG4gICAgICAgICAgICBpZiAobGMucGFzcyA9PT0gdXNlci5wYXNzd29yZCkge1xyXG4gICAgICAgICAgICAgICAgJHVzZXJzTWFuYWdlci5zZXRMb2dnZWRVc2VyKHVzZXIpO1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdpbnNpZGUudGltZWxpbmUnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdMYSBjb250cmFzZcOxYSBubyBlcyBjb3JyZWN0YScsIDIwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgbGMuZ29SZWdpc3RlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc3RhdGUuZ28oJ3JlZ2lzdGVyJyk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgJy4uLy4uL3RyYW5zdmVyc2FsL3VzZXJzTWFuYWdlcic7XHJcbmltcG9ydCAnLi4vLi4vdHJhbnN2ZXJzYWwvZXh0ZXJuYWxDYWxscyc7XHJcbmltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnY3JlZGVudGlhbHMubG9naW4nLCBbXHJcbiAgICAgICAgJ3VpLnJvdXRlcicsICAgICAgICBcclxuICAgICAgICAndHJhbnN2ZXJzYWwudXNlcnNNYW5hZ2VyJyxcclxuICAgICAgICAndHJhbnN2ZXJzYWwuZXh0ZXJuYWxDYWxscydcclxuICAgIF0pXHJcbiAgICAuY29uZmlnKGNvbmZpZylcclxuICAgIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBjb250cm9sbGVyKTsiLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcclxuICAgICduZ0luamVjdCc7XHJcblxyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgIHVybDogJy9yZWdpc3RlcicsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdzcmMvZmVhdHVyZXMvY3JlZGVudGlhbHMvcmVnaXN0ZXIvdGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ29udHJvbGxlciBhcyByYydcclxuICAgIH0pXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHN0YXRlLCAkZXh0ZXJuYWxDYWxscykge1xyXG4gICAgJ25nSW5qZWN0JztcclxuICAgIHZhciByYyA9IHRoaXM7XHJcblxyXG4gICAgcmMudHJ5UmVnaXN0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIGlmICghcmMudXNlcikge1xyXG4gICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnTm8gc2UgaGEgaW50cm9kdWNpZG8gdXN1YXJpbycsIDIwMDApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghcmMucGFzcykge1xyXG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0VsIGNhbXBvIGNvbnRyYXNlw7FhIGVzIG9ibGlnYXRvcmlvJywgMjAwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFyYy5wYXNzcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnUmVwaXRhIGxhIGNvbnRyYXNlw7FhJywgMjAwMCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmMucGFzcyAhPT0gcmMucGFzc3JlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnTGFzIGNvbnRyYXNlw7FhcyBubyBjb2luY2lkZW4nLCAyMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF91c2VybmFtZSA9IHJjLnVzZXIudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coX3VzZXJuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGV4dGVybmFsQ2FsbHMuZ2V0VXNlckJ5VXNlcm5hbWUoX3VzZXJuYW1lKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oa2VlcFRyeWluZ1JlZ2lzdGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGtlZXBUcnlpbmdSZWdpc3Rlcih1c2VyKSB7XHJcbiAgICAgICAgICAgIGlmICh1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnWWEgZXhpc3RlIGVzZSBub21icmUgZGUgdXN1YXJpbycsIDIwMDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGV4dGVybmFsQ2FsbHMucG9zdFVzZXIoX3VzZXJuYW1lLCByYy5wYXNzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZpbmlzaGluZyk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBmaW5pc2hpbmcoKSB7XHJcbiAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnVXN1YXJpbyBjcmVhZG8gY29ycmVjdGFtZW50ZScsIDE1MDAsJycsIGZ1bmN0aW9uICgpIHsgJHN0YXRlLmdvKCdsb2dpbicpOyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0iLCJpbXBvcnQgJy4uLy4uL3RyYW5zdmVyc2FsL3VzZXJzTWFuYWdlcic7XHJcbmltcG9ydCAnLi4vLi4vdHJhbnN2ZXJzYWwvZXh0ZXJuYWxDYWxscyc7XHJcbmltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnY3JlZGVudGlhbHMucmVnaXN0ZXInLCBbXHJcbiAgICAgICAgJ3VpLnJvdXRlcicsXHJcbiAgICAgICAgJ3RyYW5zdmVyc2FsLmV4dGVybmFsQ2FsbHMnXHJcbiAgICBdKVxyXG4gICAgLmNvbmZpZyhjb25maWcpXHJcbiAgICAuY29udHJvbGxlcignUmVnaXN0ZXJDb250cm9sbGVyJywgY29udHJvbGxlcik7IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICBwaG90bzogJzwnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoKSB7fSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3NyYy9mZWF0dXJlcy9pbnNpZGUvY29tcG9uZW50cy9waG90b0luTGlzdC90ZW1wbGF0ZS5odG1sJ1xyXG4gICAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2luc2lkZScsIHtcclxuICAgICAgICB1cmw6ICcvaW5zaWRlJyxcclxuICAgICAgICBhYnN0cmFjdCA6IHRydWUsXHJcbiAgICAgICAgdGVtcGxhdGVVcmwgOiAnc3JjL2ZlYXR1cmVzL2luc2lkZS90ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyIDogJ0luc2lkZUNvbnRyb2xsZXIgYXMgaWMnXHJcbiAgICB9KVxyXG4gICAgXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHN0YXRlLCAkdXNlcnNNYW5hZ2VyKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgdmFyIGljID0gdGhpcztcclxuICAgIHZhciBfZGFya0JhY2tncm91bmQgPSBcImNvbCBzNiBjZW50ZXItYWxpZ24gZ3JlZW4gZGFya2VuLTNcIjtcclxuICAgIHZhciBfbGlnaHRCYWNrZ3JvdW5kID0gXCJjb2wgczYgY2VudGVyLWFsaWduIGxpZ2h0LWdyZWVuIGFjY2VudC0xXCI7XHJcbiAgICB2YXIgX2RhcmtJY29uID0gXCJtYXRlcmlhbC1pY29ucyBtZWRpdW0gbGlnaHQtZ3JlZW4tdGV4dCB0ZXh0LWRhcmtlbi00XCI7XHJcbiAgICB2YXIgX2xpZ2h0SWNvbiA9IFwibWF0ZXJpYWwtaWNvbnMgbWVkaXVtIGxpZ2h0LWdyZWVuLXRleHQgdGV4dC1saWdodGVuLTRcIlxyXG5cclxuICAgIGljLmNsYXNzVGltZWxpbmVCYWNrZ3JvdW5kID0gX2RhcmtCYWNrZ3JvdW5kO1xyXG4gICAgaWMuY2xhc3NUaW1lbGluZUljb24gPSBfbGlnaHRJY29uO1xyXG4gICAgaWMuY2xhc3NTaGFyZVBob3RvQmFja2dyb3VuZCA9IF9saWdodEJhY2tncm91bmQ7XHJcbiAgICBpYy5jbGFzc1NoYXJlUGhvdG9JY29uID0gX2RhcmtJY29uO1xyXG5cclxuICAgIGljLmdvVGltZWxpbmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWMuY2xhc3NUaW1lbGluZUJhY2tncm91bmQgPSBfZGFya0JhY2tncm91bmQ7XHJcbiAgICAgICAgaWMuY2xhc3NUaW1lbGluZUljb24gPSBfbGlnaHRJY29uO1xyXG4gICAgICAgIGljLmNsYXNzU2hhcmVQaG90b0JhY2tncm91bmQgPSBfbGlnaHRCYWNrZ3JvdW5kO1xyXG4gICAgICAgIGljLmNsYXNzU2hhcmVQaG90b0ljb24gPSBfZGFya0ljb247XHJcbiAgICAgICAgJHN0YXRlLmdvKCdeLnRpbWVsaW5lJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIGljLmdvU2hhcmVQaG90byA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpYy5jbGFzc1RpbWVsaW5lQmFja2dyb3VuZCA9IF9saWdodEJhY2tncm91bmQ7XHJcbiAgICAgICAgaWMuY2xhc3NUaW1lbGluZUljb24gPSBfZGFya0ljb247XHJcbiAgICAgICAgaWMuY2xhc3NTaGFyZVBob3RvQmFja2dyb3VuZCA9IF9kYXJrQmFja2dyb3VuZDtcclxuICAgICAgICBpYy5jbGFzc1NoYXJlUGhvdG9JY29uID0gX2xpZ2h0SWNvbjtcclxuICAgICAgICAkc3RhdGUuZ28oJ14uc2hhcmVwaG90bycpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgaWMubG9nZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkdXNlcnNNYW5hZ2VyLmxvZ2dvdXQoKTtcclxuICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XHJcbiAgICB9O1xyXG59IiwiaW1wb3J0IGNvbmZpZyBmcm9tICcuL2NvbmZpZyc7XHJcbmltcG9ydCBjb250cm9sbGVyIGZyb20gJy4vY29udHJvbGxlcic7XHJcbmltcG9ydCAnLi90aW1lbGluZSc7XHJcbmltcG9ydCAnLi9zaGFyZS1waG90byc7XHJcbmltcG9ydCAnLi4vdHJhbnN2ZXJzYWwvdXNlcnNNYW5hZ2VyJztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2luc2lkZScsIFtcclxuICAgICAgICAndWkucm91dGVyJyxcclxuICAgICAgICAnaW5zaWRlLnRpbWVsaW5lJyxcclxuICAgICAgICAnaW5zaWRlLnNoYXJlUGhvdG8nLFxyXG4gICAgICAgICd0cmFuc3ZlcnNhbC51c2Vyc01hbmFnZXInICAgICAgICBcclxuICAgIF0pXHJcbiAgICAuY29uZmlnKGNvbmZpZylcclxuICAgIC5jb250cm9sbGVyKCdJbnNpZGVDb250cm9sbGVyJywgY29udHJvbGxlcik7IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgXHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaW5zaWRlLnNoYXJlcGhvdG8nLCB7XHJcbiAgICAgICAgdXJsOiAnL3NoYXJlcGhvdG8nLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsIDogJy9zcmMvZmVhdHVyZXMvaW5zaWRlL3NoYXJlLXBob3RvL3RlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXIgOiAnU2hhcmVQaG90b0NvbnRyb2xsZXIgYXMgc3BjJ1xyXG4gICAgfSk7XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJGV4dGVybmFsQ2FsbHMsICRzdGF0ZSkge1xyXG4gICAgJ25nSW5qZWN0J1xyXG4gICAgdmFyIHNwYyA9IHRoaXM7XHJcblxyXG4gICAgc3BjLnVwUGhvdG8gPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIGlmICghc3BjLmltZ1VybCkge1xyXG4gICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnTm8gc2UgaGEgaW50cm9kdWNpZG8gdW5hIHJ1dGEnLCAyMDAwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkZXh0ZXJuYWxDYWxscy5wb3N0UGhvdG8oc3BjLmltZ1VybCwgc3BjLnRpdGxlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaW5zaWRlLnRpbWVsaW5lJyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnT2N1cnJpbyB1biBwcm9ibGVtYS4gSW50ZW50YWxvIG1hcyB0YXJkZScsIDIwMDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSIsImltcG9ydCAnLi4vLi4vdHJhbnN2ZXJzYWwvZXh0ZXJuYWxDYWxscyc7XHJcbmltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnaW5zaWRlLnNoYXJlUGhvdG8nLCBbXHJcbiAgICAgICAgJ3RyYW5zdmVyc2FsLmV4dGVybmFsQ2FsbHMnXHJcbiAgICBdKVxyXG4gICAgLmNvbmZpZyhjb25maWcpXHJcbiAgICAuY29udHJvbGxlcignU2hhcmVQaG90b0NvbnRyb2xsZXInLCBjb250cm9sbGVyKTsiLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaW5zaWRlLnRpbWVsaW5lJywge1xyXG4gICAgICAgIHVybDogJy90aW1lbGluZScsXHJcbiAgICAgICAgdGVtcGxhdGVVcmwgOiAnL3NyYy9mZWF0dXJlcy9pbnNpZGUvdGltZWxpbmUvdGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlciA6ICdUaW1lbGluZUNvbnRyb2xsZXIgYXMgdGMnXHJcbiAgICB9KVxyXG4gICAgXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJGV4dGVybmFsQ2FsbHMpIHtcclxuICAgICduZ0luamVjdCc7XHJcbiAgICB2YXIgdGMgPSB0aGlzO1xyXG5cclxuICAgIHZhciBfcGFnZSA9IDE7XHJcbiAgICBcclxuICAgIC8qdGMucGhvdG9zID0gW3tcclxuICAgICAgICB1c2VyX2lkIDogJ0dhc3RseScsXHJcbiAgICAgICAgaW1hZ2UgOiAnaW1nL3BydWViYS5wbmcnLFxyXG4gICAgICAgIGxpa2VzIDogMTIzLFxyXG4gICAgICAgIHRpdGxlIDogJ0J1aCEnXHJcbiAgICB9LCB7XHJcbiAgICAgICAgdXNlcl9pZCA6ICdIYXVudGVyJyxcclxuICAgICAgICBpbWFnZSA6ICdpbWcvaGF1bnRlci5wbmcnLFxyXG4gICAgICAgIGxpa2VzIDogMzIxLFxyXG4gICAgICAgIHRpdGxlIDogJ0J1aCsrISdcclxuICAgIH1dOyovXHJcblxyXG4gICAgJGV4dGVybmFsQ2FsbHMuZ2V0UGhvdG9zVGltZWxpbmUoX3BhZ2UpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgdGMucGhvdG9zID0gcmVzcG9uc2U7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgdGMubW9yZVBob3RvcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBfcGFnZSsrICxcclxuICAgICAgICB0Yy5waG90b3MucHVzaCgkZXh0ZXJuYWxDYWxscy5nZXRQaG90b3MoX3BhZ2UpKTtcclxuICAgIH1cclxufSIsImltcG9ydCBjb25maWcgZnJvbSAnLi9jb25maWcnO1xyXG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xyXG5pbXBvcnQgY29tcG9uZW50IGZyb20gJy4uL2NvbXBvbmVudHMvcGhvdG9Jbkxpc3QnO1xyXG5pbXBvcnQgJy4uLy4uL3RyYW5zdmVyc2FsL2V4dGVybmFsQ2FsbHMnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnaW5zaWRlLnRpbWVsaW5lJywgW1xyXG4gICAgICAgICd1aS5yb3V0ZXInLFxyXG4gICAgICAgICd0cmFuc3ZlcnNhbC5leHRlcm5hbENhbGxzJ1xyXG4gICAgXSlcclxuICAgIC5jb25maWcoY29uZmlnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1RpbWVsaW5lQ29udHJvbGxlcicsIGNvbnRyb2xsZXIpXHJcbiAgICAuY29tcG9uZW50KCdpbnN0VGltZVBob3RvJywgY29tcG9uZW50KCkpOyIsImltcG9ydCBzZXJ2aWNlIGZyb20gJy4vc2VydmljZSc7XHJcbmltcG9ydCAnLi4vdXNlcnNNYW5hZ2VyJztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ3RyYW5zdmVyc2FsLmV4dGVybmFsQ2FsbHMnLCBbXHJcbiAgICAgICAgJ3RyYW5zdmVyc2FsLnVzZXJzTWFuYWdlcidcclxuICAgIF0pXHJcbiAgICAuc2VydmljZSgnJGV4dGVybmFsQ2FsbHMnLCBzZXJ2aWNlKTsiLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoJHVzZXJzTWFuYWdlciwgJGh0dHAsICRxKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgXHJcbiAgICB2YXIgX3VybCA9ICdodHRwOi8vbG9jYWxob3N0OjIyMjInO1xyXG4gICAgXHJcbiAgICAvLyBSZWN1cGVyYSBmb3RvcyBjb24gcGFnaW5hY2lvbi4gU2UgcGFzYW4gbG9zIGZvbGxvd2VkIHBhcmEgaGFjZXIgam9pbi5cclxuICAgIHRoaXMuZ2V0UGhvdG9zVGltZWxpbmUgPSBmdW5jdGlvbihwYWdlKSB7XHJcbiAgICAgICAgdmFyIF9xdSA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIF91c2VyID0gJHVzZXJzTWFuYWdlci5nZXRMb2dnZWRVc2VyKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICB1cmwgOiBfdXJsICsgJy9waG90b3MnLFxyXG4gICAgICAgICAgICBtZXRob2QgOiAnR0VUJyxcclxuICAgICAgICAgICAgcGFyYW1zIDogeyBwYWdlIDogcGFnZSxcclxuICAgICAgICAgICAgICAgIHVzZXJpZCA6IF91c2VyLl9pZH1cclxuICAgICAgICB9KS50aGVuKGJhY2tQaG90b3NPSylcclxuICAgICAgICAuY2F0Y2goYmFja1Bob3Rvc1dyb25nKTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrUGhvdG9zT0socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICBfcXUucmVzb2x2ZShyZXNwb25zZS5kYXRhLmRvY3MpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3F1LnJlamVjdCgnTm90aGluZyBmb3VuZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrUGhvdG9zV3JvbmcoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3F1LnJlamVjdCgnRXJyb3InKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIF9xdS5wcm9taXNlOyAgICAgICAgXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBSZWN1cGVyYSB1biB1c3VhcmlvIGhhY2llbmRvIHVzbyBkZSBzdSBpZCAoZW4gdGFibGEgZGUgbW9uZ28pXHJcbiAgICB0aGlzLmdldFVzZXJCeUlkID0gZnVuY3Rpb24oaWQpe1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBfcXUgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiAkaHR0cCh7XHJcbiAgICAgICAgICAgIHVybCA6IF91cmwgKyAnL3VzZXJzLycrIGlkLFxyXG4gICAgICAgICAgICBtZXRob2QgOiAnR0VUJ1xyXG4gICAgICAgIH0pLnRoZW4oYmFja1VzZXJPSylcclxuICAgICAgICAuY2F0Y2goYmFja1VzZXJXcm9uZyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1VzZXJPSyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhKXtcclxuICAgICAgICAgICAgICAgIF9xdS5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX3F1LnJlamVjdCgnTm90aGluZyBmb3VuZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrVXNlcldyb25nKGVycm9yKSB7XHJcbiAgICAgICAgICAgIF9xdS5yZWplY3QoJ0Vycm9yJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBfcXUucHJvbWlzZTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIFJlY3VwZXJhIHVuIHVzdWFyaW8gaGFjaWVuZG8gdXNvIGRlIHN1IHVzZXJuYW1lIFxyXG4gICAgdGhpcy5nZXRVc2VyQnlVc2VybmFtZSA9IGZ1bmN0aW9uKHVzZXJuYW1lKXtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgX3F1ID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIHVybCA6IF91cmwgKyAnL3VzZXJzJyxcclxuICAgICAgICAgICAgcGFyYW1zIDoge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHN0cmljdCA6IFwic1wiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1ldGhvZCA6ICdHRVQnXHJcbiAgICAgICAgfSkudGhlbihiYWNrVXNlck9LKVxyXG4gICAgICAgIC5jYXRjaChiYWNrVXNlcldyb25nKTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBiYWNrVXNlck9LKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEpe1xyXG4gICAgICAgICAgICAgICAgX3F1LnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBfcXUucmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmFja1VzZXJXcm9uZyhlcnJvcikge1xyXG4gICAgICAgICAgICBfcXUucmVqZWN0KCdFcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gX3F1LnByb21pc2U7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICB0aGlzLnBvc3RQaG90byA9IGZ1bmN0aW9uKHVybCwgdGl0bGUpe1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBfcXUgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBfdXNlciA9ICR1c2Vyc01hbmFnZXIuZ2V0TG9nZ2VkVXNlcigpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgdXJsIDogX3VybCArICcvcGhvdG9zJyxcclxuICAgICAgICAgICAgZGF0YSA6IHtcclxuICAgICAgICAgICAgICAgIGltYWdlIDogdXJsLFxyXG4gICAgICAgICAgICAgICAgdXNlciA6IF91c2VyLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgdXNlcl9pZCA6IF91c2VyLl9pZCxcclxuICAgICAgICAgICAgICAgIHRpdGxlIDogdGl0bGUsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1ldGhvZCA6ICdQT1NUJ1xyXG4gICAgICAgIH0pLnRoZW4odXBQaG90b09LKVxyXG4gICAgICAgIC5jYXRjaCh1cFBob3RvV3JvbmcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIHVwUGhvdG9PSyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBfcXUucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIHVwUGhvdG9Xcm9uZyhlcnJvcikge1xyXG4gICAgICAgICAgICBfcXUucmVqZWN0KCdFcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gX3F1LnByb21pc2U7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICB0aGlzLnBvc3RVc2VyID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKXtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgX3F1ID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIHVybCA6IF91cmwgKyAnL3VzZXJzJyxcclxuICAgICAgICAgICAgZGF0YSA6IHtcclxuICAgICAgICAgICAgICAgdXNlcm5hbWUgOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgcGFzc3dvcmQgOiBwYXNzd29yZCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbWV0aG9kIDogJ1BPU1QnXHJcbiAgICAgICAgfSkudGhlbih1cFVzZXJPSylcclxuICAgICAgICAuY2F0Y2godXBVc2VyV3JvbmcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIHVwVXNlck9LKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIF9xdS5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gdXBVc2VyV3JvbmcoZXJyb3IpIHtcclxuICAgICAgICAgICAgX3F1LnJlamVjdCgnRXJyb3InKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIF9xdS5wcm9taXNlO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgXHJcbn0iLCJpbXBvcnQgc2VydmljZSBmcm9tICcuL3NlcnZpY2UnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgndHJhbnN2ZXJzYWwudXNlcnNNYW5hZ2VyJywgW10pXHJcbiAgICAuc2VydmljZSgnJHVzZXJzTWFuYWdlcicsIHNlcnZpY2UpO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAoKSB7XHJcbiAgICAnbmdJbmplY3QnO1xyXG4gICAgdmFyIF9sb2dnZWQ7XHJcblxyXG4gICAgdGhpcy5zZXRMb2dnZWRVc2VyID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICBfbG9nZ2VkID0gYW5ndWxhci5jb3B5KHVzZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldExvZ2dlZFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gX2xvZ2dlZDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5sb2dnb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgX2xvZ2dlZCA9IG51bGw7XHJcbiAgICB9XHJcbn0iXX0=
